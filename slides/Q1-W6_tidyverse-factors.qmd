---
title: "Tidyverse Wrangling with Factors"
subtitle: "factors, levels, categorical data w/ base & `forcats`"
date: "2/10/2026"
footer: "D2M-R I | Week 6 & 7" #  quarter, week, and class

format: revealjs
engine: knitr

revealjs-plugins:
  - codefocus
  - fullscreen

fullscreen: false

execute:
  echo: true
  warning: false
  message: false
editor: source
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
```

# Introduction to Factors

## Factor data

**Definition**: Integer vectors with level labels

CODE BLOCK: Create a factor, show its structure with str()

**When to use factors:**

- Categorical data with fixed set of values
- Ordered categories (e.g., low/medium/high)
- Memory efficiency for repeated values
- Control ordering in plots and models

`stringr`

::: notes
**What are factors and when to use them**: Define factors as integer vectors with level labels. Explain use for categorical data with fixed, known set of values. Show memory efficiency and ordering benefits.
::: 


## Factors vs. strings

**Factors**

- Store: integers + labels
- Memory efficient
- Control ordering
- Great for: modeling, visualization

**Strings**

- Store: full text
- More memory
- Flexible manipulation
- Great for: text processing, changing categories

CODE BLOCK: Compare object size of factor vs character vector with repeated values

::: notes
**Factors vs strings**: Compare storage (factors store integers + labels vs strings store full text). Discuss when factors help (ordered categories, modeling, visualization) vs complicate (text manipulation, changing categories).
::: 


## Base R factor functions

**Core functions:**

- `factor()`: Create factor
- `levels()`: View/set levels
- `nlevels()`: Count levels
- `as.character()`: Convert to string
- `as.numeric()`: Get underlying integers

CODE BLOCK: Create factor and demonstrate each function

::: notes
**Base R factor functions**: Introduce `factor()`, `levels()`, `nlevels()`, `as.character()`, `as.numeric()`. Show common base R operations.
::: 

## `forcats` package

**For categorical variables**

CODE BLOCK: Load forcats or tidyverse

**Consistent `fct_*` naming:**

- **Reorder**: `fct_relevel`, `fct_reorder`, `fct_infreq`
- **Modify levels**: `fct_recode`, `fct_collapse`, `fct_lump`
- **Other**: `fct_drop`, `fct_rev`, `fct_explicit_na`

::: notes
**Overview of forcats package**: Introduce forcats for factor manipulation. Show `fct_*` naming convention. Preview key operations: reordering, recoding, collapsing.
:::

# Create and Inspect Factors

## Create factors

**For** **categorical variables**

CODE BLOCK: Load forcats or tidyverse

**Consistent `fct_*` naming:**

- **Reorder**: `fct_relevel`, `fct_reorder`, `fct_infreq`
- **Modify levels**: `fct_recode`, `fct_collapse`, `fct_lump`
- **Other**: `fct_drop`, `fct_rev`, `fct_explicit_na`

::: notes
**Creating factors**: Compare `factor()` (alphabetical levels by default) with `as_factor()` (order of appearance). Show specifying levels explicitly. Demonstrate labels argument for renaming during creation.
::: 

## Ordered factors

**For ordinal data with meaningful order**

`ordered()`: Creates ordered factor

**Use cases:**

- Likert scales (Strongly Disagree → Strongly Agree)
- Education levels (HS → Bachelor's → Master's → PhD)
- Sizes (Small → Medium → Large)

CODE BLOCK: Create ordered factor

CODE BLOCK: Show that comparisons work (low < high)

CODE BLOCK: Impact on modeling (polynomial contrasts)

::: notes
**Ordered factors**: Introduce `ordered()` for ordinal data with meaningful order. Show how ordering affects comparisons and modeling. Demonstrate use cases like Likert scales, education levels.
::: 


## Inspect levels

**Examine factor structure**

- `levels()`: View level labels
- `nlevels()`: Count levels
- `fct_count()`: Frequency table
- `fct_unique()`: Unique values (preserves order)

CODE BLOCK: Create factor and use each inspection function

::: notes
**Inspecting levels**: Use `levels()` to view level labels, `nlevels()` for count. Introduce `fct_count()` for frequency table. Show `fct_unique()` for unique values preserving order.
:::


# Reorder Factor Levels

## Manual reordering

`fct_relevel()`: Move levels to specific positions

- Move to front
- Move to specific position
- Partial reordering (other levels unchanged)

CODE BLOCK: Create factor with levels in wrong order

CODE BLOCK: Use fct_relevel() to move specific level to front

CODE BLOCK: Move level to specific position

::: notes
**Manual reordering**: Use `fct_relevel()` to move specific levels to front or specific positions. Show partial reordering (other levels stay in original order).
::: 

## Reorder by frequency

- `fct_infreq()`: Most common first
- `fct_inorder()`: Order by first appearance

**Perfect for bar charts!**

CODE BLOCK: Create factor with repeated values

CODE BLOCK: Reorder with fct_infreq()

CODE BLOCK: Create bar chart showing ordered bars

::: notes
**By frequency**: Use `fct_infreq()` to order by frequency (most common first). Show `fct_inorder()` to order by first appearance. Demonstrate use in creating informative bar charts.
::: 


## Reorder by another variable

`fct_reorder(f, x, fun)`: Order factor by summary of another variable

- Default: median
- Great for sorted plots

`fct_reorder2(f, x, y)`: Order by relationship with two variables

- Perfect for line plots (legend matches line order)

CODE BLOCK: Create dataset with categorical and numeric variables

CODE BLOCK: Use fct_reorder() to sort by median

CODE BLOCK: Create sorted plot

::: notes
**By another variable**: Use `fct_reorder()` to order factor by summary statistic of another variable (median by default). Show `fct_reorder2()` for ordering by two variables (useful for line plots). Demonstrate creating sorted plots.
::: 


## Reverse order

`fct_rev()`: Reverse current level order

**Use case**: Flip bar chart from top-to-bottom to bottom-to-top

CODE BLOCK: Take ordered factor and reverse it

CODE BLOCK: Show effect in a plot

::: notes
**Reversing order**: Use `fct_rev()` to reverse current level order. Show use case in flipping chart ordering.
:::


# Modifying Factor Levels

## Rename levels

`fct_recode()`: Manually rename specific levels

**Syntax**: `new_name = "old_name"`

CODE BLOCK: Create factor with messy level names

CODE BLOCK: Use fct_recode() to clean up names

::: notes
**Renaming levels**: Use `fct_recode()` to manually rename specific levels. Show old = new syntax. Demonstrate cleaning up messy category names.
::: 


## Collapse levels

**Manual**: `fct_collapse()`

- Combine multiple levels into one
- `new_name = c("old1", "old2")`

**Automatic**: `fct_lump_*()` family

- `fct_lump_n()`: Keep n most common, lump rest
- `fct_lump_prop()`: Keep levels above proportion
- `fct_lump_min()`: Keep levels with min count

CODE BLOCK: Use fct_collapse() to combine levels manually

CODE BLOCK: Use fct_lump_n() to keep top 5, lump rest

CODE BLOCK: Show in a cleaner plot


::: notes
**Collapsing levels**: Use `fct_collapse()` to combine multiple levels into single level. Show `fct_lump()` to automatically lump least common levels into "Other". Demonstrate `fct_lump_n()`, `fct_lump_prop()`, `fct_lump_min()` for different lumping strategies.
::: 

## Handle missing values

`fct_explicit_na()`: Convert NA to explicit level

**Why?**

- Make missingness visible in plots
- Include NAs in counts and summaries

CODE BLOCK: Create factor with NAs

CODE BLOCK: Convert NAs to explicit "(Missing)" level

CODE BLOCK: Show difference in a plot

::: notes
**Handling missing values**: Use `fct_explicit_na()` to convert NA to explicit "(Missing)" level. Show use in visualization to make missingness visible.
::: 

## Drop unused levels

**Remove levels with no observations**

- `droplevels()` (base R)
- `fct_drop()` (forcats)

**Common after filtering data**

CODE BLOCK: Create factor, filter to subset, show unused levels remain

CODE BLOCK: Use fct_drop() to remove unused levels

::: notes
**Dropping unused levels**: Compare `droplevels()` with `fct_drop()` to remove levels with no observations. Show use after filtering data.
:::


# Practical Applications

## Data cleaning workflow

**String cleaning → Factor creation**

Common workflow:

1. Trim whitespace
2. Standardize case
3. Fix inconsistencies
4. Convert to factor

CODE BLOCK: Messy categorical data with inconsistent entries

CODE BLOCK: Pipeline using str_trim(), str_to_lower(), str_replace(), then factor()

CODE BLOCK: Show cleaned factor


::: notes
**Data cleaning workflows**: Demonstrate pipeline combining string cleaning (trimming, case conversion) with factor creation. Show fixing inconsistent categorical entries.
::: 

## Visualization preparation

**Make better plots with factor control**

- Reorder for sorted bars (`fct_infreq`, `fct_reorder`)
- Collapse rare categories (`fct_lump_*`)
- Control legend order

CODE BLOCK: Create unsorted bar chart

CODE BLOCK: Reorder factor and recreate chart (much better!)

CODE BLOCK: Lump rare categories for cleaner visualization

::: notes
**Preparing data for visualization**: Show reordering factors for sorted bar charts and line plots. Demonstrate collapsing rare categories for cleaner plots. Illustrate controlling legend order.
::: 

## Modeling categorical data

**Factor order matters in models**

- First level = reference category in regression
- Ordered factors for ordinal models
- Relevel to change interpretation

CODE BLOCK: Fit regression model, show first level as reference

CODE BLOCK: Use fct_relevel() to change reference level

CODE BLOCK: Refit model and compare interpretation

::: notes
**Working with categorical data in models**: Show how factor ordering affects reference levels in regression. Demonstrate ordered factors for ordinal logistic regression. Illustrate releveling to change model interpretation.
:::