<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using GitHub with RStudio – Data to Manuscript in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-823d145ded7e46f5397f613d4ab5fe44.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Data to Manuscript in R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-syllabus" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Syllabus</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-syllabus">    
        <li>
    <a class="dropdown-item" href="../../syllabus/structure.html">
 <span class="dropdown-text">Course Structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/communication.html">
 <span class="dropdown-text">Communication</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/ai-policy.html">
 <span class="dropdown-text">AI Use</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/climate.html">
 <span class="dropdown-text">Climate &amp; Inclusion</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessment" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessment</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessment">    
        <li>
    <a class="dropdown-item" href="../../assessment/overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assessment/objectives.html">
 <span class="dropdown-text">Learning Objectives</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assessment/accountability.html">
 <span class="dropdown-text">Accountability</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assessment/engagement.html">
 <span class="dropdown-text">Community Engagement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assessment/menu.html">
 <span class="dropdown-text">Project Menu</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assessment/enrichment.html">
 <span class="dropdown-text">Enrichment Activities</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assessment/data-project.html">
 <span class="dropdown-text">Integrative Data Project</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-materials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-materials">    
        <li>
    <a class="dropdown-item" href="../../github.com/d2m-r/book/index.html">
 <span class="dropdown-text">Textbook (WIP)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/slides.html">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/course-resources.html">
 <span class="dropdown-text">Course Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/resources.html">
 <span class="dropdown-text">External Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/finding-data.html">
 <span class="dropdown-text">Finding Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../d2m-r.github.io"> 
<span class="menu-text">FAQ</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#some-general-resources" id="toc-some-general-resources" class="nav-link active" data-scroll-target="#some-general-resources">Some general resources</a></li>
  <li><a href="#install" id="toc-install" class="nav-link" data-scroll-target="#install">Install</a></li>
  <li><a href="#connect" id="toc-connect" class="nav-link" data-scroll-target="#connect">Connect</a>
  <ul class="collapse">
  <li><a href="#setup-pat" id="toc-setup-pat" class="nav-link" data-scroll-target="#setup-pat">Step 0</a></li>
  <li><a href="#github-to-rstudio" id="toc-github-to-rstudio" class="nav-link" data-scroll-target="#github-to-rstudio">Turn a GitHub repo into a new RStudio Project</a></li>
  <li><a href="#rstudio-to-github" id="toc-rstudio-to-github" class="nav-link" data-scroll-target="#rstudio-to-github">Turn an RStudio project into a new GitHub repo</a></li>
  <li><a href="#link-existing" id="toc-link-existing" class="nav-link" data-scroll-target="#link-existing">Connect an existing RStudio project to an existing GitHub repo</a></li>
  </ul></li>
  <li><a href="#configure" id="toc-configure" class="nav-link" data-scroll-target="#configure">Configure</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using GitHub with RStudio</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="some-general-resources" class="level1">
<h1>Some general resources</h1>
<p><a href="https://happygitwithr.com/">Happy Git and GitHub for the useR</a></p>
<p>Create a <a href="https://education.github.com">GitHub account for education</a> using your UChicago email address. This may involve sending a picture of your student ID or verifying your student status in some other way. Getting approval might take a few minutes or a few days, so do this ASAP!</p>
</section>
<section id="install" class="level1">
<h1>Install</h1>
<p><a href="https://happygitwithr.com/install-intro.html">General install guide</a></p>
<ul>
<li><a href="https://git-scm.com/downloads">Git</a>
<ul>
<li>Many options! You just need one. A binary installer will likely be easiest for you if you’ve never used the terminal or command line.</li>
</ul></li>
<li><a href="https://cran.rstudio.com/">R</a></li>
<li><a href="https://posit.co/download/rstudio-desktop/">R studio</a></li>
</ul>
<p><strong>Note: The first troubleshooting step for any issues with Terminal should be to start a new session (i.e., fully quit and reopen Terminal).</strong></p>
</section>
<section id="connect" class="level1">
<h1>Connect</h1>
<p><a href="https://happygitwithr.com/connect-intro.html">Connecting RStudio &amp; GitHub Guide</a></p>
<section id="setup-pat" class="level2">
<h2 class="anchored" data-anchor-id="setup-pat">Step 0</h2>
<p>The basic connection between RStudio the IDE (not any specific project) and your GitHub account (not any specific repo) happens by creating and storing a personal access token for HTTPS (recommended, very easy) or keys for SSH.</p>
<p>You need to set this up before you can do anything else, but you should only ever need to do it once.</p>
<p>Again, there many options for how to do this. If you don’t already have a preference, I recommend following the directions in section <a href="https://happygitwithr.com/https-pat.html">9.1 TL;DR</a>. Those simple steps should be enough to get everything working and let you skip any additional steps in the terminal.</p>
<p>Once you’ve got your PAT stored and working, you can connect local projects and remote repositories in three ways:</p>
<ol type="1">
<li><a href="#github-to-rstudio">Turn a GitHub repo into a new RStudio Project</a> - takes a minute but conceptually easy to follow</li>
<li><a href="#rstudio-to-github">Turn an RStudio project into a new GitHub repo</a> - 2 lines of code, but a little opaque if you’re new to GitHub</li>
<li><a href="#link-existing">Connect an existing RStudio project to an existing GitHub repo</a> - typically a mess, not recommended</li>
</ol>
</section>
<section id="github-to-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="github-to-rstudio">Turn a GitHub repo into a new RStudio Project</h2>
<p>I recommend starting with this method to get the hang of things, but if you want to go from an existing project to a new repo, <a href="#rstudio-to-github">instructions are below</a>. It’s actually simpler to go the other direction, but if you’re not super familiar with GitHub this way will give you a clearer concept of what’s actually happening.</p>
<ol type="1">
<li><p><strong>If you skipped the last part, <a href="#setup-pat">go back and do it</a>.</strong> You have to create and store a PAT by following the instructions in the previous section. Remember you should only need to do this once, not every time you connect a project to a repo.</p></li>
<li><p>Create a repo on GitHub:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><img src="images/CreateRepo.png" class="img-fluid"> </p></li>
</ol>
<ol start="3" type="1">
<li><p>Clone the repo (from GitHub) as a new project in R studio. This will result in a new project containing 3 files: the .Rproj file, the .gitignore, and README.md.</p>
<p><img src="images//CloneRepo.png" class="img-fluid"> </p>
<p><img src="images//CreateProject.png" class="img-fluid"> </p>
<p><img src="images//ProjectFiles.png" class="img-fluid"> </p></li>
<li><p>Confirm that you can <em>pull from</em> GitHub to RStudio:</p>
<ol type="1">
<li>Edit the readme file on the GitHub website. Add some new text or make any other obvious change.</li>
<li>Commit the changes with an informative commit message.</li>
<li>In R studio, open the Git tab and click pull. You should see a brief message describing the changes. Open the readme file in R studio and confirm the changes appear.</li>
</ol></li>
<li><p>Confirm that you can <em>push to</em> GitHub from RStudio:</p>
<ol type="1">
<li>Edit the readme file in the RStudio editor. Again, add some text or make any other obvious change and then save the file.</li>
<li>To commit the changes, click “Commit” in the Git tab to open the “Review Changes” window. Select the files you have added, deleted, or edited (in this case just README.md). You should now see a message in the Review Changes window that says “Your branch is ahead of ‘origin/main’ by 1 commit.”</li>
<li>Click “Push” to push your committed changes to GitHub.</li>
<li>Check that the changes are reflected in the readme file on GitHub.</li>
</ol></li>
</ol>
</section>
<section id="rstudio-to-github" class="level2">
<h2 class="anchored" data-anchor-id="rstudio-to-github">Turn an RStudio project into a new GitHub repo</h2>
<p>Say you’ve already got a whole project happening in RStudio but now you’re ready to add the wonders of git and GitHub to your workflow. This is pretty easy, but for a lot of people it’s less intuitive than the method above, so if you’re really starting from scratch maybe use the github-&gt;rstudio method.</p>
<ol type="1">
<li>Load the usethis package if needed (you used it in to create your PAT)</li>
<li>In your R console, run <code>use_git()</code>: This will initialize git version control for your project. You can also do this through the IDE, Tools &gt; Version Control &gt; Project Setup, select Git…but why? Just use that single function.
<ol type="1">
<li>Note: If you see a “git” tab in RStudio, your project is already using version control locally. That means you don’t need to do this part, but there’s no harm in running it. It just won’t do anything.</li>
</ol></li>
<li>In your R console, run <code>use_github()</code>: This will create a new GitHub repository (assuming you have set up your access token correctly!) with the same name as your project. It will ask you if you want to do the necessary initial commit. Enter 1 to confirm and you’re good to go!
<ol type="1">
<li>The repo will be public by default, but you can add the argument <code>private = TRUE</code> to create a private repo.</li>
</ol></li>
</ol>
</section>
<section id="link-existing" class="level2">
<h2 class="anchored" data-anchor-id="link-existing">Connect an existing RStudio project to an existing GitHub repo</h2>
<p>You can also take an existing local Rproj and connect it to a remote GitHub repo, but I don’t recommend it. The potential for migraine-inducing merge problems is just way too high. Still, if you want to do it, you can run the following code:</p>
<pre><code>
# Initialize git first if not already done
usethis::use_git()

# Then manually add the remote
git2r::remote_add(repo = ".", name = "origin", url = "https://github.com/yourusername/your-repo-name.git")
</code></pre>
<p>Again, a lot of things can go wrong. It’s unlikely anything truly irreparable will happen (that’s the whole point of version control!), but that doesn’t mean it won’t be a huge pain.</p>
</section>
</section>
<section id="configure" class="level1">
<h1>Configure</h1>
<ol type="1">
<li>On GitHub:
<ol type="1">
<li>Invite collaborators (e.g., your instructor, PI, coding team), and assign appropriate permissions, even if your repo is public. Anyone can <em>see</em> the contents of a public repo, but you must invite (or approve) collaborators to commit changes.</li>
<li>Review the other settings. It’s unlikely you’ll need to change anything at this point, but you should get a sense of what the options are.</li>
</ol></li>
<li>You may want to make changes to your repo/R project, like adding exclusions to the .gitignore, creating some folders to pre-organize, uploading data, or adding information to the readme. You can make changes like this either locally (through RStudio and/or Finder/File Explorer) or remotely (through GitHub). Be sure to commit and push all changes!</li>
<li>When you commit a change in RStudio, you might get a message about configuring your committer identity. Follow the prompted instructions to do so. By default, you’ll be editing in Terminal using VI. If that’s new to you, <a href="https://www.howtogeek.com/102468/a-beginners-guide-to-editing-text-files-with-vi/">refer to this</a>.</li>
</ol>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Pretend that everywhere you see “d2m” in these screenshots it says “d2m-r” instead. The shorthand for this class has been updated since these screenshots were taken.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>