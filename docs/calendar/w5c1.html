<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>w5c1 – Data to Manuscript in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d740b9aca1e804a685ea7468e1a48d71.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data to Manuscript in R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-syllabus" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Syllabus</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-syllabus">    
        <li>
    <a class="dropdown-item" href="../syllabus/structure.html">
 <span class="dropdown-text">Course Structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/communication.html">
 <span class="dropdown-text">Communication</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/ai-policy.html">
 <span class="dropdown-text">AI Use</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/climate.html">
 <span class="dropdown-text">Climate &amp; Inclusion</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessment" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessment</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessment">    
        <li>
    <a class="dropdown-item" href="../assessment/overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessment/objectives.html">
 <span class="dropdown-text">Learning Objectives</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessment/accountability.html">
 <span class="dropdown-text">Accountability</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessment/engagement.html">
 <span class="dropdown-text">Community Engagement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessment/data-project.html">
 <span class="dropdown-text">Integrative Data Project</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-materials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-materials">    
        <li>
    <a class="dropdown-item" href="../d2m-r.github.io/book/index.html">
 <span class="dropdown-text">Textbook (WIP)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../materials/slides.html">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../materials/misc-materials.html">
 <span class="dropdown-text">Misc. Materials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../materials/resources.html">
 <span class="dropdown-text">External Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../materials/finding-data.html">
 <span class="dropdown-text">Finding Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../d2m-r.github.io"> 
<span class="menu-text">FAQ</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<!-- 

Find and replace:

- 5 : week number (numeral only)
- 1 : class number (per week, numeral only)
- Monday, February 3, 2025 : date in format Monday, January 1, 2025
- A Grammar of Graphics : brief title/topic of the class meeting

TODO: see if there's a way to make these variables
The problem is that if they are includes with multiple on the index page, the variables would need to process before being included. 

-->
<!--
#### Announcements/Housekeeping/Etc

Text to appear before the accordion

-->
<div id="w5c1" class="accordion">
<div class="accordion-item">
<div class="accordion-header titlebox">
<p>Week 5 | Class 1</p>
</div>
</div>
<div class="accordion-item">
<div class="datebox">
<p>Monday, February 3, 2025</p>
</div>
</div>
<div class="accordion-item">
<div class="accordion-header">
<div class="accordion-button collapsed prepbox" type="button" data-bs-toggle="collapse" data-bs-target="#prep-w5c1" aria-expanded="false" aria-controls="prep-w5c1">
<p><strong>Before class:</strong> ggplot2 resources</p>
</div>
</div>
<div id="prep-w5c1" class="accordion-collapse collapse" data-bs-parent="#w5c1">
<div class="accordion-body">
<p><strong>Readings &amp; Resources:</strong></p>
<ul>
<li>Chapters on data visualization and ggplot in r4ds: <a href="https://r4ds.hadley.nz/data-visualize">1</a> and <a href="https://r4ds.hadley.nz/visualize">9, 10, 11</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf">ggplot2 cheatsheet</a></li>
<li><a href="https://ggplot2-book.org/">ggplot2-Book</a> (note: 3e is currently “under construction” but it’s still a great resource!)</li>
</ul>
</div>
</div>
</div>
<div class="accordion-item">
<div class="accordion-header">
<div class="accordion-button collapsed classbox" type="button" data-bs-toggle="collapse" data-bs-target="#class-w5c1" aria-expanded="false" aria-controls="class-w5c1">
<p><strong>Class meeting:</strong> A Grammar of Graphics</p>
</div>
</div>
<div id="class-w5c1" class="accordion-collapse collapse" data-bs-parent="#w5c1">
<div class="accordion-body">
<p><strong>Materials:</strong></p>
<ul>
<li><a href="https://uchicago.box.com/s/q8wn46x23pe6zj3hexpu0uc8mwlbqbo9">Slides</a> <em>(v1 2/3/25 12:30pm)</em></li>
<li><a href="resources/guides/origin-upstream-repos.qmd">Cloning the assessment repo</a></li>
<li><a href="https://github.com/nrdowling/d2mr-assessment/blob/main/03_data-viz/00_viz-walkthrough/data-viz-walkthrough-1.qmd">ggplot2 walkthrough part 1</a>
<ul>
<li>You can access this and run it as a stand-alone document without the rest of the repo</li>
</ul></li>
</ul>
<p><strong>Class plans:</strong></p>
<ul>
<li>Lecture: Introduction to Data Visualization with ggplot2 (A grammar of graphics)</li>
<li>Activities:
<ul>
<li>Fix the fork problem</li>
<li>ggplot2 walkthrough part 1 (together with slides)</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="accordion-item">
<div class="accordion-header">
<div class="accordion-button collapsed infobox" type="button" data-bs-toggle="collapse" data-bs-target="#info-w5c1" aria-expanded="false" aria-controls="info-w5c1">
<p><strong>Info:</strong> Fork/clone situation; Friday’s workshop</p>
</div>
</div>
<div id="info-w5c1" class="accordion-collapse collapse" data-bs-parent="#w5c1">
<div class="accordion-body">
<p><strong>Reminders:</strong></p>
<ul>
<li><strong>Assessment repo changes:</strong> We are moving to a new system where you will clone the assessment repo and then set the upstream repo to the main class repo. This is an alternative to forking that gives us (instructors) more control over the upstream repo and you more control over your own repo. <a href="resources/guides/origin-upstream-repos.qmd">See the guide here</a>.
<ul>
<li><strong>This change is mandatory.</strong> I know this is coming at a bad time and will be very frustrating for some people. I’m here to help! Please post issues in the Slack so we can resolve things quickly.</li>
<li><em>What do I do with my fork?</em> No matter what, create a local backup first. I suggest deleting your fork when you are confident the new clone system is set up and working correctly. That will help avoid confusion (on your end and mine) about which repo is the “real” one, it will prevent accidental pull requests to the main repo, and it will ensure you’re the only one with full control over your work.</li>
<li><em>I’m working on a mini-project now in my fork, what do I do?</em> If you clone your forked repo, all your ongoing work will be in the new repo. Double check that the cloned files are up to date, then continue working in the <em>clone</em> and abandon the work in your fork.</li>
<li><em>What if I already submitted mini-projects with my fork?</em> Not a problem. You have two options: 1) Leave your fork up for now until your projects have been graded (and finalized by Dr.&nbsp;Dowling). When your grade is finalized, copy the graded assessment.md file into your new clone so that you have a record of your progress in your in-use repo. 2) Resubmit your mini-project to Canvas with a link to the directory in your new clone repo. In either case, once there are no outstanding submitted Canvas assignments with links to your fork, I recommend deleting your fork.</li>
</ul></li>
<li><strong>Friday’s workshop:</strong> Friday’s class will be a data visualization workshop. Unlike the Week 4 workshop, this won’t be a “free work” period. You should come prepared to discuss your needs and goals for visualizing data for your final research project. We’ll work as a class to concetpualize what your plots should look like and prepare to make them in ggplot.
<ul>
<li>If needed, we will devote about 15 minutes to resolving issues with the GitHub change, but we have to limit that time. Please use Slack and your troubleshooting resources to resolve as many issues as possible before Friday.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="accordion-item">
<div class="accordion-header">
<div class="accordion-button collapsed todobox" type="button" data-bs-toggle="collapse" data-bs-target="#post-5c1" aria-expanded="false" aria-controls="after-w5c1">
<p><strong>After class:</strong> Fix your repo, start data viz projects</p>
</div>
</div>
<div id="post-5c1" class="accordion-collapse collapse" data-bs-parent="#w5c1">
<div class="accordion-body">
<p><strong>To-do:</strong></p>
<ol type="1">
<li>Download the ggplot2 cheatsheet</li>
<li>Migrate from the github forked assessment repo to a new cloned repo, following the directions <a href="resources/guides/origin-upstream-repos.qmd">in this guide</a> and getting support on Slack if needed</li>
<li>Prepare for Friday’s workshop by picking 2 tentative plans to visualize data for your final research project. Be ready to share in small groups and as a whole class!</li>
</ol>
<p><strong>Recommended exercises:</strong></p>
<ul>
<li><strong>Data visualization structured exercises:</strong>
<ul>
<li>Walkthrough: Introduction to data visualizaton with ggplot2 (pt1)
<ul>
<li>Demo only! This is the demo the lectures follow along with. Part 2 will be added next week.</li>
<li>Associated mini-project: <code>03_data-viz/00_viz-walkthrough</code></li>
</ul></li>
<li>Level 1: Visualize the mtcars Dataset
<ul>
<li>Work with a simple dataset to recreate 3 basic plots (using only data, aes, and geoms) and 3 intermediate plots that add other commonly used elements.</li>
<li>Associated mini-project: <code>03_data-viz/01_viz-level-1</code></li>
</ul></li>
<li>Level 2: Visualize the starwars Dataset
<ul>
<li>Work with a more complex dataset to recreate 1 advanced (and hideous) plot using many layers and theme elements.</li>
<li>Associated mini-project: <code>03_data-viz/02_viz-level-2</code></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>